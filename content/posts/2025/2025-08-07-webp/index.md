---
date: '2025-08-07 22:06:48'
title: 'ã€Hexoã€‘ä½¿ç”¨WebPæ ¼å¼çš„å›¾ç‰‡åŠ é€ŸHexoç½‘é¡µè®¿é—®é€Ÿåº¦'
description: ""
tags: [Hexo, Website, Picture]
categories: [Hexo]
math: false
---

## éœ€æ±‚æ¥æº

æˆ‘åœ¨å†™åšå®¢çš„æ—¶å€™ç»å¸¸éœ€è¦å¼•ç”¨å¾ˆå¤šç§æ ¼å¼çš„å›¾ç‰‡ï¼Œæ¯”å¦‚ `jpg`ã€`jpeg`ã€`png`ã€`gif`ï¼Œè¿™æ—¶å€™å°±å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œå„ç§å›¾ç‰‡ä¸ä»…æ ¼å¼ä¸ç»Ÿä¸€ï¼Œè€Œä¸”å¾ˆå¤šå›¾ç‰‡éå¸¸å¤§ï¼ˆå› ä¸ºæœ‰äº›å›¾ç‰‡æ˜¯è‡ªå·±æ‹çš„ï¼Œä¼ è¾“çš„æ—¶å€™æ˜¯åŸå›¾ï¼‰ï¼Œä½†æ˜¯æ”¾åœ¨åšå®¢ä¸Šçš„å›¾ç‰‡è¿™ä¹ˆå¤§æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ç½‘ç»œåœ¨ä¸Šä¼ å’Œåˆ†å‘å›¾ç‰‡çš„æ—¶å€™å¹¶ä¸ä¼šæŒ‰ç…§åŸå›¾æ¥å‘ˆç°ï¼Œè€Œä¸”è¿™æ ·çš„æ¸…æ™°åº¦å¯¹äºç½‘é¡µæµè§ˆåŒæ ·ä¹Ÿèµ„æºè¿‡å‰©ï¼Œåè€Œé€ æˆäº†æµé‡çš„æµªè´¹å’Œç”¨æˆ·çš„ç­‰å¾…æ—¶é—´è¿‡é•¿ï¼ˆé™¤äº†ä¸€äº›æ‘„å½±ç½‘ç«™ä¹‹ç±»çš„å¯èƒ½éœ€è¦åŸå›¾ï¼‰ã€‚

å› æ­¤æˆ‘å¿…é¡»è§£å†³å›¾ç‰‡æ ¼å¼ä¸ç»Ÿä¸€å’Œå›¾ç‰‡è¿‡å¤§çš„é—®é¢˜ï¼Œè¿™æ—¶å€™æˆ‘å°±æƒ³èƒ½ä¸èƒ½å…ˆåœ¨æœ¬åœ°å°†å›¾ç‰‡å‹ç¼©ï¼ˆæœ€å¥½æ˜¯æ— æŸçš„ï¼‰ï¼Œç„¶åä¸Šä¼ çš„æ—¶å€™ç›´æ¥ä¸Šä¼ å‹ç¼©è¿‡åçš„å›¾ç‰‡å°±å¯ä»¥äº†ï¼Œè¿™æ ·å°±èƒ½è§£å†³å›¾ç‰‡è¿‡å¤§çš„é—®é¢˜ã€‚ç„¶åæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯è§£å†³é€‰æ‹©å‹ç¼©åˆ°ä»€ä¹ˆæ ¼å¼ï¼Œç»è¿‡ä¸€ç•ªæ¢ç´¢ï¼Œæˆ‘é€‰æ‹©å‹ç¼©æˆ[WebPæ ¼å¼](https://developers.google.cn/speed/webp?hl=zh-cn)ï¼š

> WebP æ˜¯ä¸€ç§æ–°å‹å›¾ç‰‡æ ¼å¼ï¼Œå¯ä¸ºç½‘ç»œä¸Šçš„å›¾ç‰‡æä¾›å“è´¨å“è¶Šçš„æ— æŸå’Œæœ‰æŸå‹ç¼©ã€‚ä½¿ç”¨ WebPï¼Œç½‘ç«™ç«™é•¿å’Œç½‘ç»œå¼€å‘è€…å¯ä»¥åˆ›å»ºä½“ç§¯æ›´å°ä½†ç»†èŠ‚æ›´ä¸°å¯Œçš„å›¾ç‰‡ï¼Œä»è€Œæé«˜ç½‘ç»œè®¿é—®é€Ÿåº¦ã€‚
>
> WebP æ— æŸå›¾ç‰‡æ¯” PNG å›¾ç‰‡å° [26%](https://developers.google.cn/speed/webp/docs/webp_lossless_alpha_study?hl=zh-cn#results)ã€‚WebP æœ‰æŸå›¾ç‰‡æ¯”é‡‡ç”¨ç­‰æ•ˆ [SSIM](https://en.wikipedia.org/wiki/Structural_similarity) è´¨é‡æŒ‡æ ‡çš„åŒç­‰ JPEG å›¾ç‰‡[ç¼©å° 25-34%](https://developers.google.cn/speed/webp/docs/webp_study?hl=zh-cn)ã€‚
>
> æ— æŸ WebP æ”¯æŒé€æ˜åº¦ï¼ˆä¹Ÿç§°ä¸º Alpha é€šé“ï¼‰ï¼Œåªéœ€[å¢åŠ  22% çš„å­—èŠ‚](https://developers.google.cn/speed/webp/docs/webp_lossless_alpha_study?hl=zh-cn#results)ã€‚å¯¹äºå¯ä»¥æ¥å—æœ‰æŸ RGB å‹ç¼©çš„æƒ…å†µï¼Œæœ‰æŸ WebP ä¹Ÿæ”¯æŒé€æ˜åº¦ï¼Œç”Ÿæˆçš„æ–‡ä»¶å¤§å°é€šå¸¸æ¯” PNG å° 3 å€ã€‚
>
> åŠ¨ç”» WebP å›¾ç‰‡æ”¯æŒæœ‰æŸã€æ— æŸå’Œé€æ˜ï¼Œä¸ GIF å’Œ APNG ç›¸æ¯”ï¼Œå¯ä»¥ç¼©å‡æ–‡ä»¶å¤§å°ã€‚

é€‰æ‹©WebPæ ¼å¼çš„åŸå› é™¤äº†æ”¯æŒå¾ˆå¤šæ ¼å¼å›¾ç‰‡çš„è½¬æ¢å¤–ï¼Œè¿˜å› ä¸ºå®ƒæ”¯æŒå¾ˆå¤šæµè§ˆå™¨ï¼ˆIEæµè§ˆå™¨ç”¨æˆ·å°±ä¸ç®¡äº†ï¼Œæ²¡æœ‰åŠæ³•é€‚é…æ‰€æœ‰ç”¨æˆ·ï¼‰ï¼š

> Google Chromeã€Safariã€Firefoxã€Edgeã€Opera æµè§ˆå™¨ä»¥åŠ[è®¸å¤šå…¶ä»–](https://developers.google.com/speed/webp/faq?hl=zh-cn#which_web_browsers_natively_support_webp)å·¥å…·å’Œè½¯ä»¶åº“éƒ½åŸç”Ÿæ”¯æŒ WebPã€‚å¼€å‘è€…è¿˜æ·»åŠ äº†å¯¹å„ç§å›¾ç‰‡ç¼–è¾‘å·¥å…·çš„æ”¯æŒã€‚
>
> WebP åŒ…æ‹¬è½»é‡çº§ç¼–ç å’Œè§£ç åº“ [`libwebp`](https://developers.google.com/speed/webp/docs/api?hl=zh-cn)ï¼Œä»¥åŠç”¨äºå°†å›¾ç‰‡è½¬æ¢ä¸º WebP æ ¼å¼å’Œä» WebP æ ¼å¼è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼çš„å‘½ä»¤è¡Œå·¥å…· [`cwebp`](https://developers.google.com/speed/webp/docs/cwebp?hl=zh-cn) å’Œ [`dwebp`](https://developers.google.com/speed/webp/docs/dwebp?hl=zh-cn)ï¼Œä»¥åŠç”¨äºæŸ¥çœ‹ã€æ··åˆå’Œä¸º WebP å›¾ç‰‡æ·»åŠ åŠ¨ç”»æ•ˆæœçš„å·¥å…·ã€‚å®Œæ•´çš„æºä»£ç å¯åœ¨[ä¸‹è½½](https://developers.google.com/speed/webp/download?hl=zh-cn)é¡µé¢ä¸Šæ‰¾åˆ°ã€‚

å› æ­¤æœ€ç»ˆæˆ‘æ‰“ç®—å°†Hexoåšå®¢ä¸Šçš„å›¾ç‰‡éƒ½è½¬æ¢ä¸ºWebPæ ¼å¼ã€‚æ¥ä¸‹æ¥å°†éœ€æ±‚æ‹†è§£ï¼š

- åœ¨æœ¬åœ°å®‰è£…WebPè½¬æ¢æ‰€éœ€è¦çš„åº“ `libwebp`
- ç¼–å†™ `PowerShell` è„šæœ¬ï¼ˆæˆ‘æ‰€ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ Windows 10ï¼‰è‡ªåŠ¨å°†å…¶ä»–æ ¼å¼çš„å›¾ç‰‡è½¬æ¢æˆ `.webp` æ ¼å¼çš„å›¾ç‰‡
- ç¼–å†™æ–°çš„ `PowerShell` è„šæœ¬ä¿®æ”¹ `.md` çš„ Markdown æ–‡ä»¶ä¸­å¼•ç”¨å›¾ç‰‡çš„åœ°æ–¹ï¼Œå°†å„ç§æ ¼å¼çš„å›¾ç‰‡åç¼€æ”¹æˆ `.webp`ï¼ˆå› ä¸ºæˆ‘ä½¿ç”¨ Typora æ¥ç›´æ¥æ‹–æ‹½å¼•å…¥åŸå›¾ï¼Œæ‰€ä»¥éœ€è¦åœ¨å†™å®Œä¿å­˜ `.md` æ–‡ä»¶åå†æ‰¹é‡ä¿®æ”¹ `.md` æ–‡ä»¶ä¸­å¼•ç”¨å›¾ç‰‡çš„åœ°æ–¹ï¼‰
- å°†å‰é¢ä¸¤ä¸ªè„šæœ¬æ•´åˆåˆ°æœ¬åœ°é¢„è§ˆå’Œè¿œç¨‹éƒ¨ç½²çš„è„šæœ¬å½“ä¸­

## éœ€æ±‚å®ç°

### å®‰è£…WebPåº“

å®‰è£…WebPè½¬æ¢ç›¸åº”çš„åº“ï¼Œæˆ‘é‡‡ç”¨ [Scoop](https://chen-huaneng.github.io/2024/01/04/2024-01-04-2024-01-04-Scoop/) è¿›è¡Œå®‰è£…ï¼š

```powershell
scoop install main/libwebp
```

å®‰è£…å®Œæˆä¹‹åé€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š

```powershell
cwebp -version
```

### ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬

åœ¨Hexoåšå®¢ç›®å½•ä¸‹åˆ›å»ºå››ä¸ªè„šæœ¬åˆ†åˆ«ç”¨äºæ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼š

- `local.ps1` ç”¨äºåœ¨æœ¬åœ°é¢„è§ˆæœ€ç»ˆçš„ä¿®æ”¹æ•ˆæœ
- `deploy.ps1` ç”¨äºéƒ¨ç½²åˆ°è¿œç¨‹æ‰˜ç®¡ä»“åº“
- `convert-to-webp.ps1` ç”¨äºå°†æœ¬åœ°çš„å…¶ä»–å›¾ç‰‡æ ¼å¼è½¬æ¢ä¸º `.webp` å›¾ç‰‡æ ¼å¼
- `update-markdown-images.ps1` ç”¨äºæ›´æ–° `.md` æ–‡ä»¶ä¸­å¼•ç”¨å›¾ç‰‡çš„åœ°æ–¹

ä¸‹é¢è„šæœ¬çš„å†…å®¹å¯ä»¥æ ¹æ®ä¸ªäººå­˜æ”¾ä½ç½®å’Œéœ€æ±‚çš„ä¸åŒè¿›è¡Œæ›´æ”¹ã€‚

`local.ps1`ï¼š

```powershell
cd E:\ChenHuaneng\Article\Academic\academic-homepage
bundle exec jekyll build
robocopy "_site" "E:\ChenHuaneng\Article\Blogs\source\academic" /E /NFL /NDL /NP /XO
cd E:\ChenHuaneng\Article\Blogs
Write-Host "è¿è¡ŒWebPè½¬æ¢..."
& .\convert-to-webp.ps1
Write-Host "æ›´æ–°Markdownå›¾ç‰‡å¼•ç”¨..."
& .\update-markdown-images.ps1
npx hexo clean
npx hexo g
npx hexo s -p 8080
```

`deploy.ps1`ï¼š

```powershell
# ä¿®æ”¹å­¦æœ¯ä¸»é¡µ
Write-Host "ä¿®æ”¹å­¦æœ¯ä¸»é¡µ..."
cd E:\ChenHuaneng\Article\Academic\academic-homepage
bundle exec jekyll build
robocopy "_site" "E:\ChenHuaneng\Article\Blogs\source\academic" /E /NFL /NDL /NP /XO
cd E:\ChenHuaneng\Article\Blogs
# æŸ¥çœ‹å½“å‰ä¿®æ”¹çš„æ–‡ä»¶
$gitStatus = git status --porcelain
$gitAhead = git status -b --porcelain | Select-String "ahead"

# åˆ¤æ–­æ˜¯å¦æœ‰ä¿®æ”¹æˆ–è€…æœªæ¨é€çš„æäº¤
if ($gitStatus -or $gitAhead) {
    Write-Host "æ£€æµ‹åˆ°ä¿®æ”¹æˆ–æœªæ¨é€çš„æäº¤ï¼Œå¼€å§‹å¤„ç†..."
    
    if ($gitStatus) {
        # æ·»åŠ æ‰€æœ‰ä¿®æ”¹çš„æ–‡ä»¶
        git add .

        # æäº¤ä¿®æ”¹ï¼Œè‡ªåŠ¨ç”Ÿæˆæäº¤ä¿¡æ¯
        $currentTime = Get-Date -Format "yyyy-MM-dd HH:mm:ss"
        $commitMessage = "Auto commit at $currentTime"
        git commit -m $commitMessage
    } else {
        Write-Host "æ²¡æœ‰æ£€æµ‹åˆ°æ–°çš„ä¿®æ”¹ï¼Œä½†æœ‰æœªæ¨é€çš„æäº¤ã€‚"
    }

    # æ¨é€åˆ°è¿œç¨‹ä»“åº“
    git push -u origin main
} else {
    Write-Host "æ²¡æœ‰æ£€æµ‹åˆ°ä¿®æ”¹æˆ–æœªæ¨é€çš„æäº¤ï¼Œè·³è¿‡ Git æ“ä½œã€‚"
}

Write-Host "å¼€å§‹å›¾ç‰‡WebPè½¬æ¢..."
Set-Location "E:\ChenHuaneng\Article\Blogs"
& .\convert-to-webp.ps1
Write-Host "WebPè½¬æ¢å®Œæˆï¼"

Write-Host "æ›´æ–°Markdownä¸­çš„å›¾ç‰‡å¼•ç”¨..."
& .\update-markdown-images.ps1
Write-Host "å›¾ç‰‡å¼•ç”¨æ›´æ–°å®Œæˆï¼"

# é‡æ–°ç”Ÿæˆé™æ€ç½‘é¡µ
npx hexo clean
npx hexo g

# éƒ¨ç½²æ›´æ–°åçš„ç½‘é¡µæ–‡ä»¶
hexo deploy
```

`convert-to-webp.ps1`ï¼š

```powershell
param(
    [string]$basePath = "E:\ChenHuaneng\Article\Blogs\source"
)

# æ”¯æŒçš„å›¾ç‰‡æ‰©å±•å
$imageExtensions = @('.png','.jpg','.jpeg','.gif','.avif')

# éœ€è¦å¤„ç†çš„ç›®å½•
$directories = @('imgs', '_posts', 'academic')

# è·å–cwebpå®Œæ•´è·¯å¾„ (é¿å…ç¯å¢ƒå˜é‡é—®é¢˜)
$cwebpPath = (Get-Command cwebp).Source

foreach ($dir in $directories) {
    $fullPath = Join-Path $basePath $dir
    if (Test-Path $fullPath) {
        Write-Host "Processing directory: $fullPath"
        # é€’å½’å¤„ç†å­ç›®å½•ä¸­çš„å›¾ç‰‡
        $files = Get-ChildItem -Path $fullPath -Recurse -File | Where-Object { $imageExtensions -contains $_.Extension.ToLower() }
        
        foreach ($file in $files) {
            $webpPath = [System.IO.Path]::ChangeExtension($file.FullName, 'webp')
            
            # ä»…å½“WebPæ–‡ä»¶ä¸å­˜åœ¨æˆ–æ¯”åŸå›¾æ–°æ—¶è½¬æ¢
            if (-not (Test-Path $webpPath) -or $file.LastWriteTime -gt (Get-Item $webpPath).LastWriteTime) {
                try {
                    # ä¿®å¤å‚æ•°ä¼ é€’é—®é¢˜
                    $qualityArg = "-q", "75"
                    
                    # å¤„ç†GIFçš„ç‰¹æ®Šæƒ…å†µ
                    if ($file.Extension -eq '.gif') {
                        # GIFä½¿ç”¨gif2webpå·¥å…·å¤„ç†
                        $gif2webpPath = (Get-Command gif2webp).Source
                        & $gif2webpPath "-q" "75" "-mixed" "$($file.FullName)" "-o" "$webpPath"
                    }
                    else {
                        # å…¶ä»–å›¾ç‰‡ä½¿ç”¨cwebp
                        & $cwebpPath "-q" "75" "$($file.FullName)" "-o" "$webpPath"
                    }
                    
                    if ($LASTEXITCODE -eq 0) {
                        Write-Host "âœ… Converted: $($file.Name) â†’ $([System.IO.Path]::GetFileName($webpPath))"
                    } else {
                        Write-Host "âš ï¸ Failed to convert: $($file.FullName) (Exit code: $LASTEXITCODE)"
                    }
                } catch {
                    Write-Host "ğŸ›‘ Error processing $($file.FullName): $_"
                }
            } else {
                Write-Host "â© Skipped (up-to-date): $($file.Name)"
            }
        }
    }
}

Write-Host "ğŸ‰ WebP conversion complete!"
```

`update-markdown-images.ps1`ï¼š

```powershell
# å‚æ•°å®šä¹‰ï¼šåŸºç¡€ç›®å½•è·¯å¾„ï¼ˆå¯è¿è¡Œæ—¶æŒ‡å®šï¼‰
param([string]$basePath = "E:\ChenHuaneng\Article\Blogs\source")

# å®šä¹‰ç›®æ ‡å­ç›®å½•å’Œæ”¯æŒçš„å›¾ç‰‡æ‰©å±•å
$directories = @('_posts', 'image', 'about')
$imageExtensions = @('.png','.jpg','.jpeg','.gif','.avif')

# è·å–å¾…å¤„ç†çš„ Markdown æ–‡ä»¶ï¼ˆ3å¤©å†…ä¿®æ”¹ï¼‰
$markdownFiles = Get-ChildItem -Path $basePath -Recurse -Include "*.md" | 
    Where-Object { 
        $_.DirectoryName -match "($($directories -join '|'))" -and
        $_.LastWriteTime -gt (Get-Date).AddDays(-3) 
    }

# éå†æ¯ä¸ªæ–‡ä»¶è¿›è¡Œæ›¿æ¢
foreach ($file in $markdownFiles) {
    $content = Get-Content -Path $file.FullName -Raw
    
    # æ­£åˆ™è¡¨è¾¾å¼ï¼šåŒ¹é… Markdown å›¾ç‰‡è¯­æ³•
    $typoraPattern = '\!\[(.*?)\]\((.*?)(' + 
        ($imageExtensions + $imageExtensions.ToUpper() | Join-String -Separator "|") + 
        ')\)'
    
    # æ‰§è¡Œæ›¿æ¢ï¼ˆä¿ç•™æè¿°å’Œè·¯å¾„ï¼Œä»…ä¿®æ”¹æ‰©å±•åä¸º .webpï¼‰
    $newContent = $content -replace $typoraPattern, '![$1]($2.webp)'
    
    # ä¿å­˜ä¿®æ”¹åçš„æ–‡ä»¶
    if ($newContent -ne $content) {
        Set-Content -Path $file.FullName -Value $newContent -NoNewline
        Write-Host "âœ… Updated $($file.Name)"
    } else {
        Write-Host "â© No images to update in $($file.Name)"
    }
}
Write-Host "ğŸ‰ All Markdown files updated to reference WebP images"
```
